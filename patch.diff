 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/crm/src/App.js b/crm/src/App.js
index cd382ca55c2de1ed8d5eb3163666f5736e3dac9a..8ede55b4e18820962e9d7f79952925f5e9f63b55 100644
--- a/crm/src/App.js
+++ b/crm/src/App.js
@@ -2712,51 +2712,51 @@ function App() {
   };
 
   const MeuEspaco = ({ user, resolveActiveStoreForWrite, currentStoreIdForDisplay }) => {
     const now = new Date();
     const initialMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
     const [selectedMonth, setSelectedMonth] = useState(initialMonth);
     const [companyInfo, setCompanyInfo] = useState({
       nome: '',
       endereco: '',
       cnpj: '',
       atividade: '',
       horarioTrabalho: '',
       competencia: `${String(now.getMonth() + 1).padStart(2, '0')}/${now.getFullYear()}`,
       gestorResponsavel: ''
     });
     const [companyLoading, setCompanyLoading] = useState(false);
     const [companySaving, setCompanySaving] = useState(false);
     const [records, setRecords] = useState([]);
     const [recordsLoading, setRecordsLoading] = useState(false);
     const [registerLoading, setRegisterLoading] = useState(false);
     const [registerMessage, setRegisterMessage] = useState(null);
     const [selectedEmployee, setSelectedEmployee] = useState('self');
     const [employees, setEmployees] = useState([]);
     const [employeesLoading, setEmployeesLoading] = useState(false);
     const [editingRecord, setEditingRecord] = useState(null);
-    const [editForm, setEditForm] = useState({ horaEntrada: '', horaSaida: '', irregularidade: '', qtde: '', justificativa: '' });
+    const [editForm, setEditForm] = useState({ horaEntrada: '', horaSaida: '', horaAlmocoSaida: '', horaAlmocoRetorno: '', irregularidade: '', qtde: '', justificativa: '' });
     const [savingEdit, setSavingEdit] = useState(false);
     const [todayRecordData, setTodayRecordData] = useState(null);
 
     const isManager = user ? [ROLE_OWNER, ROLE_MANAGER].includes(user.role) : false;
     const userId = user?.auth?.uid || '';
     const userName = user?.auth?.displayName || user?.auth?.email || 'Gestor';
 
     const competenciaLabel = useMemo(() => {
       const [year, month] = selectedMonth.split('-');
       return `${month}/${year}`;
     }, [selectedMonth]);
 
     useEffect(() => {
       if (isManager) {
         setSelectedEmployee('all');
       } else if (userId) {
         setSelectedEmployee(userId);
       }
     }, [isManager, userId]);
 
     useEffect(() => {
       setCompanyInfo((prev) => ({ ...prev, competencia: competenciaLabel }));
     }, [competenciaLabel]);
 
     useEffect(() => {
@@ -2858,51 +2858,58 @@ function App() {
         } else {
           setTodayRecordData(null);
         }
       }, () => setTodayRecordData(null));
       return () => unsubscribe();
     }, [currentStoreIdForDisplay, userId]);
 
     const getDayInfo = (record) => {
       if (record.dia) {
         const date = new Date(record.dia);
         return date;
       }
       if (record.data && typeof record.data.toDate === 'function') {
         return record.data.toDate();
       }
       return null;
     };
 
     const formatTime = (value) => value || '--:--';
 
     const getWorkedTime = (registro) => {
       if (registro.qtde) return registro.qtde;
       if (!registro.horaEntrada || !registro.horaSaida) return '-';
       const [hIn, mIn] = registro.horaEntrada.split(':').map(Number);
       const [hOut, mOut] = registro.horaSaida.split(':').map(Number);
-      const minutes = (hOut * 60 + mOut) - (hIn * 60 + mIn);
+      let minutes = (hOut * 60 + mOut) - (hIn * 60 + mIn);
+
+      if (registro.horaAlmocoSaida && registro.horaAlmocoRetorno) {
+        const [hLunchOut, mLunchOut] = registro.horaAlmocoSaida.split(':').map(Number);
+        const [hLunchIn, mLunchIn] = registro.horaAlmocoRetorno.split(':').map(Number);
+        minutes -= (hLunchIn * 60 + mLunchIn) - (hLunchOut * 60 + mLunchOut);
+      }
+
       if (Number.isNaN(minutes) || minutes <= 0) return '-';
       const hrs = Math.floor(minutes / 60);
       const mins = minutes % 60;
       return `${hrs}h ${String(mins).padStart(2, '0')}m`;
     };
 
     const filteredRecords = useMemo(() => {
       const sorted = [...records].sort((a, b) => {
         const dateA = getDayInfo(a);
         const dateB = getDayInfo(b);
         if (!dateA || !dateB) return 0;
         return dateA - dateB;
       });
       if (isManager) {
         if (selectedEmployee === 'all') return sorted;
         return sorted.filter(item => item.funcionarioId === selectedEmployee);
       }
       return sorted.filter(item => item.funcionarioId === userId);
     }, [records, isManager, selectedEmployee, userId]);
 
     const todayRecord = todayRecordData;
 
     const requestLocation = () => new Promise((resolve, reject) => {
       if (!navigator.geolocation) {
         reject(new Error('Seu navegador não suporta geolocalização.'));
@@ -2953,157 +2960,181 @@ function App() {
         setRegisterLoading(true);
         setRegisterMessage(null);
         const position = await requestLocation();
         const coords = {
           latitude: Number(position.coords.latitude.toFixed(6)),
           longitude: Number(position.coords.longitude.toFixed(6)),
           capturedAt: new Date().toISOString()
         };
         const capturedAddress = await getAddressFromCoordinates(coords);
         const storeId = resolveActiveStoreForWrite();
         const pontosRef = collection(db, 'lojas', storeId, 'pontos');
         const currentDate = new Date();
         const dayKey = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(currentDate.getDate()).padStart(2, '0')}`;
         const competenciaKey = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
         if (selectedMonth !== competenciaKey) {
           setSelectedMonth(competenciaKey);
         }
         const existingQuery = query(
           pontosRef,
           where('funcionarioId', '==', userId),
           where('dia', '==', dayKey),
           where('competencia', '==', competenciaKey),
           limit(1)
         );
         const snapshot = await getDocs(existingQuery);
-        const payload = type === 'entrada'
-          ? {
-            horaEntrada: formatTimeString(new Date()),
+        const nowTime = formatTimeString(new Date());
+        const payload = {
+          entrada: {
+            horaEntrada: nowTime,
             localizacaoEntrada: coords,
             localizacaoEntradaEndereco: capturedAddress || ''
-          }
-          : {
-            horaSaida: formatTimeString(new Date()),
+          },
+          almoco_inicio: {
+            horaAlmocoSaida: nowTime
+          },
+          almoco_fim: {
+            horaAlmocoRetorno: nowTime
+          },
+          saida: {
+            horaSaida: nowTime,
             localizacaoSaida: coords,
             localizacaoSaidaEndereco: capturedAddress || ''
-          };
+          }
+        }[type];
+
+        if (!payload) {
+          throw new Error('Tipo de registro inválido.');
+        }
 
         if (snapshot.empty) {
-          if (type === 'saida') {
-            throw new Error('Registre a entrada antes de registrar a saída.');
+          if (type !== 'entrada') {
+            throw new Error('Registre a entrada antes de registrar o horário.');
           }
           await addDoc(pontosRef, {
             funcionarioId: userId,
             funcionarioNome: userName,
             dia: dayKey,
             data: Timestamp.now(),
             horaEntrada: payload.horaEntrada,
             horaSaida: '',
+            horaAlmocoSaida: '',
+            horaAlmocoRetorno: '',
             localizacaoEntrada: payload.localizacaoEntrada,
             localizacaoEntradaEndereco: payload.localizacaoEntradaEndereco || '',
             localizacaoSaida: null,
             localizacaoSaidaEndereco: '',
             irregularidade: '',
             qtde: '',
             justificativa: '',
             competencia: competenciaKey,
             empresaId: currentStoreIdForDisplay,
             historicoAlteracoes: [],
             createdAt: serverTimestamp()
           });
         } else {
           const docRef = snapshot.docs[0].ref;
           await updateDoc(docRef, {
             ...payload,
             updatedAt: serverTimestamp()
           });
         }
-        setRegisterMessage({ type: 'success', text: `Ponto de ${type === 'entrada' ? 'entrada' : 'saída'} registrado com sucesso!` });
+        const actionMap = {
+          entrada: 'entrada',
+          almoco_inicio: 'início do almoço',
+          almoco_fim: 'retorno do almoço',
+          saida: 'saída'
+        };
+        setRegisterMessage({ type: 'success', text: `Ponto de ${actionMap[type]} registrado com sucesso!` });
       } catch (error) {
         console.error('Erro ao registrar ponto', error);
         setRegisterMessage({ type: 'error', text: error.message || 'Não foi possível registrar o ponto.' });
       } finally {
         setRegisterLoading(false);
       }
     };
 
     const handleSaveCompanyInfo = async (event) => {
       event.preventDefault();
       if (!isManager) return;
       if (!currentStoreIdForDisplay || currentStoreIdForDisplay === STORE_ALL_KEY) {
         alert('Selecione uma loja para salvar as informações.');
         return;
       }
 
       try {
         setCompanySaving(true);
         const storeId = resolveActiveStoreForWrite();
         const companyDoc = doc(db, 'lojas', storeId, 'meuEspaco', 'empresa');
         await setDoc(companyDoc, {
           nome: companyInfo.nome || '',
           endereco: companyInfo.endereco || '',
           cnpj: companyInfo.cnpj || '',
           atividade: companyInfo.atividade || '',
           horarioTrabalho: companyInfo.horarioTrabalho || '',
           competencia: competenciaLabel,
           gestorResponsavel: companyInfo.gestorResponsavel || userName,
           gestorId: userId,
           atualizadoEm: serverTimestamp()
         }, { merge: true });
         setRegisterMessage({ type: 'success', text: 'Informações da empresa salvas com sucesso!' });
       } catch (error) {
         console.error('Erro ao salvar dados da empresa', error);
         setRegisterMessage({ type: 'error', text: 'Não foi possível salvar as informações da empresa.' });
       } finally {
         setCompanySaving(false);
       }
     };
 
     const openEditModal = (record) => {
       setEditingRecord(record);
       setEditForm({
         horaEntrada: record.horaEntrada || '',
         horaSaida: record.horaSaida || '',
+        horaAlmocoSaida: record.horaAlmocoSaida || '',
+        horaAlmocoRetorno: record.horaAlmocoRetorno || '',
         irregularidade: record.irregularidade || '',
         qtde: record.qtde || '',
         justificativa: record.justificativa || ''
       });
     };
 
     const handleSaveEdit = async () => {
       if (!editingRecord) return;
       try {
         setSavingEdit(true);
         const storeId = resolveActiveStoreForWrite();
         const recordRef = doc(db, 'lojas', storeId, 'pontos', editingRecord.id);
         const nowDate = new Date();
-        await updateDoc(recordRef, {
-          horaEntrada: editForm.horaEntrada || '',
-          horaSaida: editForm.horaSaida || '',
-          irregularidade: editForm.irregularidade || '',
-          qtde: editForm.qtde || '',
-          justificativa: editForm.justificativa || '',
+          await updateDoc(recordRef, {
+            horaEntrada: editForm.horaEntrada || '',
+            horaSaida: editForm.horaSaida || '',
+            horaAlmocoSaida: editForm.horaAlmocoSaida || '',
+            horaAlmocoRetorno: editForm.horaAlmocoRetorno || '',
+            irregularidade: editForm.irregularidade || '',
+            qtde: editForm.qtde || '',
+            justificativa: editForm.justificativa || '',
           gestorId: userId,
           dataAjuste: serverTimestamp(),
           historicoAlteracoes: arrayUnion({
             data: nowDate.toISOString(),
             gestor: userName,
             alteracoes: { ...editForm }
           })
         });
         setRegisterMessage({ type: 'success', text: 'Registro de ponto atualizado.' });
         setEditingRecord(null);
       } catch (error) {
         console.error('Erro ao atualizar registro', error);
         setRegisterMessage({ type: 'error', text: 'Não foi possível atualizar o registro.' });
       } finally {
         setSavingEdit(false);
       }
     };
 
     if (!currentStoreIdForDisplay || currentStoreIdForDisplay === STORE_ALL_KEY) {
       return (
         <div className="p-4 md:p-6">
           <div className="bg-white rounded-2xl shadow p-6 text-center">
             <h2 className="text-xl font-semibold text-gray-800 mb-2">Selecione uma loja</h2>
             <p className="text-gray-600">Para acessar o Meu Espaço, escolha uma loja específica no topo do sistema.</p>
           </div>
@@ -3125,213 +3156,250 @@ function App() {
         )}
 
         <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
           <div className="bg-white rounded-2xl shadow p-6 space-y-4">
             <div className="flex items-center justify-between">
               <div>
                 <h2 className="text-xl font-semibold text-gray-800">Registro de ponto</h2>
                 <p className="text-gray-500 text-sm">A localização é capturada automaticamente.</p>
               </div>
               <Clock className="w-10 h-10 text-pink-500" />
             </div>
             <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
               <Button
                 onClick={() => handleRegisterPoint('entrada')}
                 disabled={registerLoading}
               >
                 Registrar entrada
               </Button>
               <Button
                 variant="secondary"
                 onClick={() => handleRegisterPoint('saida')}
                 disabled={registerLoading || !todayRecord?.horaEntrada}
               >
                 Registrar saída
               </Button>
+              <Button
+                variant="outline"
+                onClick={() => handleRegisterPoint('almoco_inicio')}
+                disabled={registerLoading || !todayRecord?.horaEntrada}
+              >
+                Registrar início do almoço
+              </Button>
+              <Button
+                variant="outline"
+                onClick={() => handleRegisterPoint('almoco_fim')}
+                disabled={registerLoading || !todayRecord?.horaAlmocoSaida}
+              >
+                Registrar retorno do almoço
+              </Button>
             </div>
             {todayRecord && (
-              <div className="grid grid-cols-2 gap-4 text-sm bg-gray-50 rounded-xl p-4">
+              <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm bg-gray-50 rounded-xl p-4">
                 <div>
                   <p className="text-gray-500">Entrada</p>
                   <p className="font-semibold text-gray-800">{formatTime(todayRecord.horaEntrada)}</p>
                 </div>
                 <div>
                   <p className="text-gray-500">Saída</p>
                   <p className="font-semibold text-gray-800">{formatTime(todayRecord.horaSaida)}</p>
                 </div>
+                <div>
+                  <p className="text-gray-500">Início do almoço</p>
+                  <p className="font-semibold text-gray-800">{formatTime(todayRecord.horaAlmocoSaida)}</p>
+                </div>
+                <div>
+                  <p className="text-gray-500">Retorno do almoço</p>
+                  <p className="font-semibold text-gray-800">{formatTime(todayRecord.horaAlmocoRetorno)}</p>
+                </div>
               </div>
             )}
           </div>
 
           <form onSubmit={handleSaveCompanyInfo} className="bg-white rounded-2xl shadow p-6 space-y-4">
             <div className="flex items-center justify-between">
               <div>
                 <h2 className="text-xl font-semibold text-gray-800">Informações da empresa</h2>
                 <p className="text-gray-500 text-sm">Dados exibidos no cabeçalho do relatório.</p>
               </div>
             </div>
             <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
               <Input label="Nome da empresa" value={companyInfo.nome} onChange={(e) => setCompanyInfo({ ...companyInfo, nome: e.target.value })} disabled={!isManager} required={isManager} />
               <Input label="CNPJ" value={companyInfo.cnpj} onChange={(e) => setCompanyInfo({ ...companyInfo, cnpj: e.target.value })} disabled={!isManager} />
               <Input label="Endereço" value={companyInfo.endereco} onChange={(e) => setCompanyInfo({ ...companyInfo, endereco: e.target.value })} disabled={!isManager} />
               <Input label="Atividade econômica" value={companyInfo.atividade} onChange={(e) => setCompanyInfo({ ...companyInfo, atividade: e.target.value })} disabled={!isManager} />
               <Input label="Horário de trabalho" value={companyInfo.horarioTrabalho} onChange={(e) => setCompanyInfo({ ...companyInfo, horarioTrabalho: e.target.value })} disabled={!isManager} />
               <Input label="Competência" value={competenciaLabel} disabled readOnly />
               <Input label="Gestor responsável" value={companyInfo.gestorResponsavel || userName} onChange={(e) => setCompanyInfo({ ...companyInfo, gestorResponsavel: e.target.value })} disabled={!isManager} />
             </div>
             {isManager && (
               <div className="flex justify-end">
                 <Button type="submit" disabled={companyLoading || companySaving}>{companySaving ? 'Salvando...' : 'Salvar informações'}</Button>
               </div>
             )}
           </form>
         </div>
 
         <div className="bg-white rounded-2xl shadow p-6 space-y-4">
           <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
-            <div>
-              <h2 className="text-xl font-semibold text-gray-800">Registros do mês</h2>
-              <p className="text-gray-500 text-sm">Visualização automática do mês selecionado.</p>
+            <div className="flex items-center gap-3">
+              <div>
+                <h2 className="text-xl font-semibold text-gray-800">Registros do mês</h2>
+                <p className="text-gray-500 text-sm">Visualização automática do mês selecionado.</p>
+              </div>
+              <span className="inline-flex items-center rounded-full bg-pink-100 text-pink-700 px-3 py-1 text-sm font-semibold">
+                Registros ({filteredRecords.length})
+              </span>
             </div>
             <div className="flex flex-wrap gap-3">
               <Input
                 type="month"
                 label="Mês"
                 value={selectedMonth}
                 onChange={(e) => setSelectedMonth(e.target.value)}
                 className="min-w-[160px]"
               />
               {isManager && (
                 <Select label="Colaborador" value={selectedEmployee} onChange={(e) => setSelectedEmployee(e.target.value)} disabled={employeesLoading} className="min-w-[200px]">
                   {employeesLoading ? (
                     <option>Carregando...</option>
                   ) : (
                     <>
                       <option value="all">Todos</option>
                       {employees.map((employee) => (
                         <option key={employee.id} value={employee.id}>{employee.nome || employee.email || employee.id}</option>
                       ))}
                     </>
                   )}
                 </Select>
               )}
             </div>
           </div>
 
           {recordsLoading ? (
             <div className="py-10 text-center text-gray-500">Carregando registros...</div>
           ) : filteredRecords.length === 0 ? (
             <div className="py-10 text-center text-gray-500">Nenhum registro encontrado para o período selecionado.</div>
           ) : (
             <div className="overflow-x-auto">
               <table className="min-w-full text-sm">
                 <thead>
                   <tr className="text-left text-gray-500">
                     <th className="py-3 px-4">Dia da semana</th>
-                    <th className="py-3 px-4">Dia</th>
+                    <th className="py-3 px-4">Dia do Mês</th>
+                    <th className="py-3 px-4">Funcionário</th>
                     <th className="py-3 px-4">Entrada</th>
+                    <th className="py-3 px-4">Saída almoço</th>
+                    <th className="py-3 px-4">Retorno almoço</th>
                     <th className="py-3 px-4">Saída</th>
                     <th className="py-3 px-4">Irregularidade</th>
                     <th className="py-3 px-4">Qtde</th>
                     <th className="py-3 px-4">Justificativa</th>
-                    <th className="py-3 px-4">Localização</th>
+                    {isManager && <th className="py-3 px-4">Localização</th>}
                     {isManager && <th className="py-3 px-4">Ações</th>}
                   </tr>
                 </thead>
                 <tbody className="divide-y">
                   {filteredRecords.map((registro) => {
                     const date = getDayInfo(registro);
                     const diaSemana = date ? date.toLocaleDateString('pt-BR', { weekday: 'long' }) : '-';
                     const diaMes = date ? String(date.getDate()).padStart(2, '0') : '-';
                     return (
                       <tr key={registro.id} className="hover:bg-gray-50">
                         <td className="py-3 px-4 capitalize">{diaSemana}</td>
                         <td className="py-3 px-4">{diaMes}</td>
+                        <td className="py-3 px-4">{registro.funcionarioNome || '-'}</td>
                         <td className="py-3 px-4 font-semibold">{formatTime(registro.horaEntrada)}</td>
+                        <td className="py-3 px-4 font-semibold">{formatTime(registro.horaAlmocoSaida)}</td>
+                        <td className="py-3 px-4 font-semibold">{formatTime(registro.horaAlmocoRetorno)}</td>
                         <td className="py-3 px-4 font-semibold">{formatTime(registro.horaSaida)}</td>
                         <td className="py-3 px-4">{registro.irregularidade || '-'}</td>
                         <td className="py-3 px-4">{getWorkedTime(registro)}</td>
                         <td className="py-3 px-4 max-w-xs">{registro.justificativa || '-'}</td>
-                        <td className="py-3 px-4">
-                          <div className="space-y-3 text-xs">
-                            {registro.localizacaoEntrada && (
-                              <div className="space-y-1">
-                                <div className="flex items-center gap-1 font-semibold text-pink-600">
-                                  <MapPin className="w-4 h-4" /> Entrada
+                        {isManager && (
+                          <td className="py-3 px-4">
+                            <div className="space-y-3 text-xs">
+                              {registro.localizacaoEntrada && (
+                                <div className="space-y-1">
+                                  <div className="flex items-center gap-1 font-semibold text-pink-600">
+                                    <MapPin className="w-4 h-4" /> Entrada
+                                  </div>
+                                  <p className="text-gray-600">
+                                    {registro.localizacaoEntradaEndereco || 'Endereço não disponível'}
+                                  </p>
+                                  <a
+                                    href={`https://maps.google.com/?q=${registro.localizacaoEntrada.latitude},${registro.localizacaoEntrada.longitude}`}
+                                    target="_blank"
+                                    rel="noopener noreferrer"
+                                    className="inline-flex items-center gap-1 text-pink-600 hover:underline"
+                                  >
+                                    Ver no mapa
+                                  </a>
                                 </div>
-                                <p className="text-gray-600">
-                                  {registro.localizacaoEntradaEndereco || 'Endereço não disponível'}
-                                </p>
-                                <a
-                                  href={`https://maps.google.com/?q=${registro.localizacaoEntrada.latitude},${registro.localizacaoEntrada.longitude}`}
-                                  target="_blank"
-                                  rel="noopener noreferrer"
-                                  className="inline-flex items-center gap-1 text-pink-600 hover:underline"
-                                >
-                                  Ver no mapa
-                                </a>
-                              </div>
-                            )}
-                            {registro.localizacaoSaida && (
-                              <div className="space-y-1">
-                                <div className="flex items-center gap-1 font-semibold text-emerald-600">
-                                  <MapPin className="w-4 h-4" /> Saída
+                              )}
+                              {registro.localizacaoSaida && (
+                                <div className="space-y-1">
+                                  <div className="flex items-center gap-1 font-semibold text-emerald-600">
+                                    <MapPin className="w-4 h-4" /> Saída
+                                  </div>
+                                  <p className="text-gray-600">
+                                    {registro.localizacaoSaidaEndereco || 'Endereço não disponível'}
+                                  </p>
+                                  <a
+                                    href={`https://maps.google.com/?q=${registro.localizacaoSaida.latitude},${registro.localizacaoSaida.longitude}`}
+                                    target="_blank"
+                                    rel="noopener noreferrer"
+                                    className="inline-flex items-center gap-1 text-emerald-600 hover:underline"
+                                  >
+                                    Ver no mapa
+                                  </a>
                                 </div>
-                                <p className="text-gray-600">
-                                  {registro.localizacaoSaidaEndereco || 'Endereço não disponível'}
-                                </p>
-                                <a
-                                  href={`https://maps.google.com/?q=${registro.localizacaoSaida.latitude},${registro.localizacaoSaida.longitude}`}
-                                  target="_blank"
-                                  rel="noopener noreferrer"
-                                  className="inline-flex items-center gap-1 text-emerald-600 hover:underline"
-                                >
-                                  Ver no mapa
-                                </a>
-                              </div>
-                            )}
-                          </div>
-                        </td>
+                              )}
+                            </div>
+                          </td>
+                        )}
                         {isManager && (
                           <td className="py-3 px-4">
                             <Button size="sm" variant="secondary" onClick={() => openEditModal(registro)}>Editar</Button>
                           </td>
                         )}
                       </tr>
                     );
                   })}
                 </tbody>
               </table>
             </div>
           )}
         </div>
 
         <Modal isOpen={Boolean(editingRecord)} onClose={() => setEditingRecord(null)} title="Editar registro" size="lg">
           <div className="space-y-4">
             <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
               <Input label="Hora de entrada" type="time" value={editForm.horaEntrada} onChange={(e) => setEditForm({ ...editForm, horaEntrada: e.target.value })} />
               <Input label="Hora de saída" type="time" value={editForm.horaSaida} onChange={(e) => setEditForm({ ...editForm, horaSaida: e.target.value })} />
+              <Input label="Saída para almoço" type="time" value={editForm.horaAlmocoSaida} onChange={(e) => setEditForm({ ...editForm, horaAlmocoSaida: e.target.value })} />
+              <Input label="Retorno do almoço" type="time" value={editForm.horaAlmocoRetorno} onChange={(e) => setEditForm({ ...editForm, horaAlmocoRetorno: e.target.value })} />
               <Input label="Irregularidade" value={editForm.irregularidade} onChange={(e) => setEditForm({ ...editForm, irregularidade: e.target.value })} />
               <Input label="Quantidade (horas)" value={editForm.qtde} onChange={(e) => setEditForm({ ...editForm, qtde: e.target.value })} />
             </div>
             <Textarea label="Justificativa" value={editForm.justificativa} onChange={(e) => setEditForm({ ...editForm, justificativa: e.target.value })} />
             <div className="flex justify-end gap-3">
               <Button variant="secondary" onClick={() => setEditingRecord(null)}>Cancelar</Button>
               <Button onClick={handleSaveEdit} disabled={savingEdit}>{savingEdit ? 'Salvando...' : 'Salvar ajustes'}</Button>
             </div>
           </div>
         </Modal>
       </div>
     );
   };
 
   // --- CORREÇÃO: Props do Dashboard atualizadas ---
   const Dashboard = ({handleStopAndSnoozeAlarm, isAlarmPlaying, isAlarmSnoozed, hasNewPendingOrders, snoozeEndTime}) => {
     const { pedidos, clientes } = data;
     
     // --- CORREÇÃO: Lógica de display da soneca movida para dentro do Dashboard ---
     const [snoozeDisplay, setSnoozeDisplay] = useState('');
     const snoozeDisplayTimerRef = useRef(null);
     // --- CORREÇÃO: State local para audioUnlocked (lido do manager) ---
     const [audioAllowed, setAudioAllowed] = useState(audioManager.unlocked);
 
     // Efeito para observar mudanças no estado 'unlocked' do AudioManager
 
EOF
)